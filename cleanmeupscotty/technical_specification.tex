\documentclass[DIV=calc, paper=a4, fontsize=11pt]{scrartcl} % Документ принадлежит классу article, а также будет печататься в 12 пунктов.
\usepackage{ucs}
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8x]{inputenc} % Включаем поддержку UTF8
\usepackage[russian]{babel} % Пакет поддержки русского языка
\usepackage{titling} % Allows custom title configuration

%for frames
\usepackage{framed}

%For image using
\usepackage{graphicx}

%Numbering subsubsubsections etc
\setcounter{secnumdepth}{5}

%For code highlightning
\usepackage{listings}

%Further enumeration
\usepackage{enumitem}
\setenumerate[1]{label=\theparagraph.\arabic*.}
\setenumerate[2]{label*=\arabic*.}
\setenumerate[3]{label*=\arabic*.}


%For referencing within enumeration lists
\usepackage{enumitem}

%Packages for word-like comment style
\usepackage{todonotes}

%Package for images
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

%For a nicer reference
\usepackage{fancyref}

\usepackage{titlesec}

\usepackage{xcolor}

% For nice JSON output 
\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}


\titleformat*{\section}{\LARGE\bfseries}
\titleformat*{\subsection}{\Large\bfseries}
\titleformat*{\subsubsection}{\large\bfseries}
\titleformat*{\paragraph}{\large\bfseries}
\titleformat*{\subparagraph}{\large\bfseries}

%For some math formulas if needed
\usepackage{mathtools}

% Some nice visualization
%\usepackage[svgnames]{xcolor} % Enabling colors by their 'svgnames'
\usepackage{fullpage}
%\renewcommand{\headrulewidth}{0.0pt} % No header rule
%\renewcommand{\footrulewidth}{0.4pt} % Thin footer rule
% End visualization

%smart enumeration
\renewcommand{\labelenumi}{\arabic{enumi}.}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}


% General document settings
% % %
% Accepted file upload formats
\newcommand{\AcceptedFormats}{.txt, .csv, .xls, .xlsx}

\title{ТЗ на ЛК и мобильное приложение для химчистки}

\date{01/04/2016}

\begin{document}

\maketitle

\section{Описание проекта}
Рабочее название проекта - cleanmeupscotty. Состоит из двух частей - личного кабинета пользователя (представляет собой веб-сайт на Битриксе) и двух мобильных приложений (или одним с разными доступами и разным функционалом).
\\subsection{Личный кабинет (сайт)}
Суть заключается в следующем - в личный кабинет (ЛК) на сайт поступает информация от сервера, который обрабатывает данные ПО химчистки. Например о статусе определенной вещи. Также видна некая статистика - сколько вещей было сдано, сколько денег потрачено, сколько бонусных баллов заработано.
\subsection{Мобильное приложение для клиента}
Дублирует основной функционал личного кабинета (выводит данные сервера химчистки). Дополнительно позволяет вызывать водителя к текущему местоположению для того, что бы он забрал вещи.
\subsection{Мобильное приложение для водителя}
Позволяет принимать заказ от клиента. Отправляет данные на сервер химчистки.


\section{Схема работы}

	\begin{figure}[H]
        \centering
        \includegraphics[width=480px]{scheme.png}
        \caption{Схема связей в общей системе\label{fig:scheme.png}}
    \end{figure}
    
Из точек приема 1...N поступают данные о заказах на общий сервер. Сервер отправляет данные также и обратно (эта сторона не касается проекта, данный обмен налажен на стороне ПО химчистки).
\\[0.5cm]
У сервера есть интерфейс приложения (application interface, API), с помощью которого можно запрашивать данные с сервера. Эти данные показываются клиенту в его личном кабинете (на сайте или в мобильном приложении).
\\[0.5cm]
Заказывая сбор вещей на дом, клиент вызывает водителя, который забирает грязные вещи. Водитель через свое приложение отмечает что он их принял. \todo[inline]{Нужно ли? Водитель разве не просто отдает вещи в одной из точек приема? Тогда нижняя стрелка не нужна}


\section{Параметры}


\subsection{Личный кабинет}

\subsubsection{Запрос}
К серверу химчистки отправляется GET-запрос, который содержит в себе уникальный идентификатор клиента.
Пример запроса: 
\begin{displaymath}
	http://api.cleanmeupscotty.ru/params?clientid=7817236178
\end{displaymath}	

\subsubsection{Ответ}\label{subsubsec:response_lk}
От сервера химчистки приходят данные в формате XML или JSON. Перечень данных:
\begin{itemize}
	\item Кол-во вещей в обработке
	\item Накопленные баллы
	\item Общее кол-во сданных вещей
	\item Перечень вещей в обработке (для каждой вещи получаем уникальный айди от химчистки, наименование, статус по химчистке, цену на 
	\item Общий перечень всего сданных вещей
	\item Статус клиента
\end{itemize}

Пример ответа может выглядеть так:
\begin{lstlisting}[language=json,firstnumber=1]
{"client": {
  "id": "7817236178",
  "status": "vip",
  "current_items": 3,
  "bonus_miles": 9351,
  "clothes_current": {
    "cloth": [
      {"id": 4125124, "value": "Platje", "status": "clean", "price": 490},
      {"id": 89172387, "value": "Rubashka", "status": "being cleaned", "price": 199},
      {"id": 171273, "value": "Kostjum", "status": "preparation", "price": 2500}
    ],
    "furniture": [
    	{"id": 7887182, "value" "Pokrivalo on divana", "status": "preparation", "price": 4900}
    ]
  },
  "clother_all": {
  	"listing_all_clothes": ...
  }
}}
\end{lstlisting}

\subsection{Мобильное приложение клиента}
Мобильное приложение является полным дублем веб-личного кабинета и показывает в удобном интерфейсе те же данные (см. пункт \ref{subsubsec:response_lk}). Дополнительно мобильное приложение позволяет вызвать водителя для сбора вещей, которые необходимо отдать в чистку.

\subsubsection{Запросы}
Мобильное приложение основано на веб-личном кабинете, соответственно мобильное приложение "общается" с сайтом, а тот, в свою очередь с сервером ПО химчистки. Дополнительно к общему функционалу у мобильного приложение есть уникальный функционал - заказ водителя.

\paragraph{Вызов водителя}
При нажатии на кнопку у пользователя есть выбор двух опций - время и место. Время по умолчанию стоит "сейчас". Пользователь может альтернативно выбрать определенное время. Место стоит по умолчанию "здесь" и выбирает текущее местоположение пользователя, альтернативно пользователь может выбрать местоположение.
\\[0.5cm]
Для местоположения - так как сервис рассчитан на Москву выбираем только улицу, дом и квартиру.

\subsection{Мобильное приложение водителя}
Данное приложение получает заявки от мобильных приложений клиентов. 

\subsubsection{Схема работы}
Водитель может принять заказа или проигнорировать его. После того, как он принял заказ должен открываться навигатор и показывать маршрут к месту назначения клиента. По прибытии и забора вещей водитель должен отметить в системе, что он забрал вещи (или не забрал, в этом случае нужно указать причину). Если навигатор отдал назад ответ, что водитель приехал и он не нажал ни одну из кнопок, то экран должен мигать красным.

\paragraph{Прием заказа}
Заказ попадает к водителям в определенном радиусе от клиента. Всегда проверяем по шагу, равному 1км. Если водитель(и) в радиусе 1км от местоположения клиента (или адреса заказа) не отреагировали (или таковых вообще нет), то ищем в радиусе 2км и т.д. Можно поставить лимит 200км, что бы приложение не уходило в бесконечный цикл. Увеличиваем шаг каждые 5 минут.
\\[0.5cm]
Пример - клиент размещает заказ на свое текущее местоположение. Приложение ищет водителей, находит одного в радиусе 1км. Тот занят, так как везет обратно вещи другому клиенту. Через некоторое время приложение расширяет радиус поиска до 2км. Там приложение находит двух водителей. Тот из них, который ближе к точке клиента получает запрос быстрее. Каждому водителю в текущем радиусе показываем запрос с 30и секундным запозданием, чем дальше он от точки назначения. Первый водитель ближе к клиенту, но он пропустил сообщение. Через 30 секунд запрос отображается второму водителю, который сразу подтверждает. Он и получает заказ, нажимает "поехали" и включается навигация к точке клиента.

\paragraph{Навигация}
Имеет смысл использовать стороннюю, гугл или яндекс навигаторы например. От них необходим ответ, что по GPS координатам дивайс прибыл к цели.

\end{document}








