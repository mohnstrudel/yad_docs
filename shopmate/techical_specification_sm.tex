\documentclass[DIV=calc, paper=a4, fontsize=11pt]{scrartcl} % Документ принадлежит классу article, а также будет печататься в 12 пунктов.
\usepackage{ucs}
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8x]{inputenc} % Включаем поддержку UTF8
\usepackage[russian]{babel} % Пакет поддержки русского языка
\usepackage{titling} % Allows custom title configuration

%for frames
\usepackage{framed}

%For image using
\usepackage{graphicx}

%Numbering subsubsubsections etc
\setcounter{secnumdepth}{5}

%For code highlightning
\usepackage{listings}

%Further enumeration
\usepackage{enumitem}
\setenumerate[1]{label=\theparagraph.\arabic*.}
\setenumerate[2]{label*=\arabic*.}
\setenumerate[3]{label*=\arabic*.}


%For referencing within enumeration lists
\usepackage{enumitem}

%Packages for word-like comment style
\usepackage{todonotes}

%Package for images
\usepackage{float}
\floatstyle{boxed}
\restylefloat{figure}

%For a nicer reference
\usepackage{fancyref}

\usepackage{titlesec}


\titleformat*{\section}{\LARGE\bfseries}
\titleformat*{\subsection}{\Large\bfseries}
\titleformat*{\subsubsection}{\large\bfseries}
\titleformat*{\paragraph}{\large\bfseries}
\titleformat*{\subparagraph}{\large\bfseries}

%For some math formulas if needed
\usepackage{mathtools}

% Some nice visualization
%\usepackage[svgnames]{xcolor} % Enabling colors by their 'svgnames'
\usepackage{fullpage}
%\renewcommand{\headrulewidth}{0.0pt} % No header rule
%\renewcommand{\footrulewidth}{0.4pt} % Thin footer rule
% End visualization

%smart enumeration
\renewcommand{\labelenumi}{\arabic{enumi}.}
\renewcommand{\labelenumii}{\arabic{enumi}.\arabic{enumii}}


\title{Система для учета магазина - shopmate (рабочее название)}
\date{15/04/2015}

\begin{document}

\maketitle

\section{Описание проекта}
Система shopmate позволяет вести оперативную деятельность (продуктового) магазина, начиная с оформлении поставки и заканчивая фактической продажей. Shopmate делится на модули, каждый из которых может работать автономно, но раскрывает весь свой потенциал только при взаимодействии с другими модулями. 

\section{Технические уточнения}

\subsection{Термины}

        \begin{itemize}
        \item Блок - некий визуальный элемент, выделяющийся либо графически (в виде рамок, очертаний), либо по смыслу (совокупность похожих элементов)
        \item Компонент - часть содержания, имеющего закрытое визуально представление. Одна страница сайта может состоять из нескольких компонентов.
        \item Фронтэнд - для пользователя видимая оболочка веб-страницы
        \item Бэкэнд - невидимые для пользователя математические алгоритмы
        \item CMS - все работы происходят на основе системы управления содержанием - CMS 1C Bitrix (1С Битрикс)
        \item Модуль - является описанием общего функционала, который не может быть классифицирован как привязанный к определенной странице. Он может встречаться на любой странице в любом месте. Модуль может состоять из нескольких компонентов. Также модуль может содержать в себе части логики фронтэнда и бэкэнда.
        \item Хэдер - верхняя часть сайта, обладающая определенной структурой, которая видна сквозняком на всех или почти всех страницах сайта. Также используется обозначение "шапка".
        \item Футер - нижняя часть сайта. Функционал аналогичен хэдеру. Также используется обозначение "подвал".
        \item Тетрадка - рабочее и финальное название для кабинета салона красоты.
        \item Зеркало - рабочее название для сайта, который доступен клиенту (позже этот сайт будет по-умолчанию доступен по адресу getbam.ru)
    \end{itemize}


\subsection{Технические требования к сайту}
Сайт должен быть адаптивным, поддерживать IE 8+ и использовать технологию композита.
Тут ещё больше технического бла-бла.


\section{Модули}

Каждый модуль должен обладать индивидуальными правами доступа.

\subsection{Товары/Склад}

Данный модуль позволяет заносить новые товары, редактировать существующие, удалять (т.е. стандартные CRUD действия). Занесение и просмотр товаров вынесены отдельно, так как подразумевают специфичную логику. Например занесение должно в более поздних релизах работать через считывание штрих-кодов. Для хранения данных о товаре должен использоваться стандартный компонент товаров и складской системы Битрикс-магазина для того, что бы в любой момент можно было к системе shopmate подключить интернет-продажу (тем более оффлайн-продажа отличается только одной опцией от интернет-магазина - оплатой наличными). Важно разделять занесение нового товара (данная чатсь программы представляет собой справочник) и оприходывание товара (поступает новая партия товара). Т.е. если при занесении товара я ввожу его базовые характеристики (такие как название например), то при оприходывании я заношу параметры конкретной партии (поставщка, закупочную цену и т.д.).

\subsubsection{Занесение новых товаров} \label{subsubsec:new_goods}

Данная страница позволяет занести новый товар в виде справочника (т.е. не поступившую партию, а именно товар как сущность). Пользователь заносит товар обычно один раз и очень редко редактирует. Параметры товара:
\begin{itemize}
	\item Название товара
	\item Категория товара (справочник должен редактироваться в общей админке, там же привязываем к категории отдел магазина (например к мясу - мясной цех), одному отделу могут принадлежать несколько категорий) \label{subsec:newgoods}
	\item Штрихкод (у одного и того же товара может быть несколько штрихкодов, для этого предусмотрено добавление дополнительного штрихкода)
	\item Единица измерения
	\item Описание товара
\end{itemize}

\subsubsection{Оприходывание новых товаров}

\paragraph{Релиз Альфа}
Если приходит новая партия товара, то пользователь заносит этот товар через накладную, одна накладная может содержать одну или несколько позиций товаров с определенными параметрами. Накладных может быть неограниченно количество и создаваться они будут часто.
\\[0.5cm]
Первично пользователь должен внести название накладной (добавляем маску, что бы он понимал как заносить данные) и дату (по умолчанию подгружаем текущую дату, но также даем возможность поменять (опять же, с маской)). Далее пользователь выбирает поставщика (текстовое поле с саджестом). После этого в каждой строке он может занести одну партию товара. Каждая строка состоит из определенных параметров товара.

Параметры товара:

\begin{itemize}
	\item Штрихкод (можно занести вручную, а также с помощью сканнера). Если человек занес штрихкод, то базовые параметры (название) должны подгружаться автоматически. Если он занес штрихкод, но система не нашла такого товара, то должна предложить ему создать новый товар (открываем форму в попапе).
	\item Название - хранятся в справочнике (см. пункт \ref{subsubsec:new_goods}), при занесение должен работать саджест (или подгружаем уже по штрихкоду)
	\item Кол-во по накладной (должно соответствовать в точности бумажному документу)
	\item Кол-во по факту (если пришло меньше (или больше), то нельзя это фиксировать в поле "кол-во по накладной", нужно обязательно отдельно вынести)
	\item Цена на продажу (см. отдельный пункт ниже)
	\item Закупочная цена
	\item Дату истечения срока годности, если товар скоропортящийся
\end{itemize}
При занесении цены у пользователя должен быть следующий выбор:
\begin{itemize}
	\item Использовать старую цену (если такой товар уже есть) - стандартный функционал.
	\item Ввести новую цену и обновить эту цену для всех уже существующих товаров. При этом новую цену можно ввести в виде двух параметров (на выбор) - в качестве накидки процентов на закупочную цену или в свободной форме 
\end{itemize}
При этом дефолтно просто загружается текущая цена. Но также у пользователья есть возможность ввести новую цену в абсолютном значении или в процентуальном прибавлении/убавлении. Для сохранения первого сценария нужно просто оставить поле с дефолтным значением и ничего не делать. 
\\[0.5cm]
Для изменения цены пользователь может сразу в обзоре позиций накладной занести абсолютное значение, либо нажав на "+" открыть всплывающее окно, которое дает несколько вариантов на выбор:

\begin{itemize}
	\item Оставить все как есть (если пользователь нажал по ошибке)
	\item Накинуть процент - вводим значение процента...
	\item ...и выбираем к чему накинуть процент:
	\item на закупочную цену текущий поставки
	\item на самую дорогую закупку
	\item на среднезакупочную цену
\end{itemize}


Для каждого товара также необходимо предусмотреть индивидуальные прайслисты клиента. Т.е. индивидуальный прайслист всегда приоритетнее всех остальных ценовых настроек.
\paragraph{Релиз Бета}
Необходимо подключить функционал считывание штрих-кодов, а также занесения товаров при принятии товаров от поставщика.\todo[inline]{Тут очень важно ещё уточнить как это в действительности происходит. У складовщика скорее всего  будет просто считыватель штрих-кодов? Также скорее всего он должен будет просто принять данные (считать коды), а потом у себя на компьютере увидеть список товаров, которые он принял и начать их обрабоку}

\paragraph{Релиз Гамма}

\subsubsection{Просмотр товаров}

Просмотр товара осуществляется в стандартном табличном виде с делением на категории и подкатегории. При нажатии на товар можно просмотреть его детальные параметры, а также удалить товар. 

\paragraph{Скоропортящийся товар}
Важно вынести отдельным элементом (по сути это будет простой предзаготовленный фильтр) - скоропортящиеся продукты. Нажав на данный фильтр видны все скоропортящиеся товары, отсортированные по дате истечения срока годности (самая ближайшая дата в самом начале). Если по конкретному скоропорту занесено несколько накладных, то в общем обзоре берем самую ближайшую дату истечения срока годности.

\paragraph{Релиз Бета или Гамма}
Добавляем просмотр в виде плиток.

\subsubsection{Редактирование товара}

Для редактирования доступны не только сами товары, но и опции для категорий и подкатегорий. Так например нужно иметь возможность менять цены для всей категории товаров (добавить 30\% например). Также очень важно для каждого поля (параметра) товара иметь отдельные права на редактирование. Параметры, доступные для просмотра/редактирования:
\begin{itemize}
	\item Название товара (только через выпадающий список)
	\item Количество - только администратор может менять это поле! Обязательно нужна проверка на права!
	\item Цена на продажу
	\item Закупочная цена - как и при занесении товара, тут можно оставить как есть либо обновить (опять же - либо абсолютным, либо процентуальным значением)
	\item Задолженность по товару - только админ может редактировать
	\item Все выплаты по товару - только админ
	\item Описание товара
\end{itemize}

На этой же странице доступна история изменений в товаре.

\paragraph{История изменений товара}
История фиксирует все возможные манипуляции с конкретным товаром. Приход, уход (продажу), изменение параметров, все фиксируется и выводится в формате:
\\[0.5cm](дата)(значение)(действие)(было)(стало)
\\[0.5cm]Например: 17/04/2015 - количество - приход - было: 0 - стало: 640
Для истории для каждого поля нужно хранить два его значения (действие). Так, для количества это может быть - приход (мы получаем товар) и продажа (мы расстаемся с товаром). Для задолженности это будут - оплата (мы платим по счетам) и кредиторка (мы откладываем платеж, задолженность растет).

\subsubsection{Накладные}
Отдельным от товаров табом находятся накладные. Здесь виден обзор всех накладных, которые были занесены через "оприходывание товара". Для обзора доступны следующие поля:

\begin{itemize}
	\item Номер накладной
	\item Кол-во занесенных в накладную товаров
	\item Общая закупочная цена по накладной
	\item Дата поступления накладной
	\item Сколько оплачено по накладной (берем значение, которое занес пользователь, делим его на общую закупочную сумму)
	\item Если в накладной есть скоропорт, какая самая ранняя дата истечения срока годности
\end{itemize}

Просмотр накладной полностью идентичен занесению новой накладной, только с разницей, что значения уже не редактируемы (очень важно!)

\paragraph{Фильтры для скоропорта}
Очень важно для накладных добавить две дефолтные опции фильтра - "показать только накладные со скоропортом" и "показать накладные с просроченным товаром". Данные виды подгружают все накладные со скоропортящимися товарами, а также сортируют их по дате истечения срока годности. 

\subparagraph{Просроченные товары}
Здесь необходимо вывести только товары, истечение срока годности которых уже в прошлом. Также подсвечиваем строки с таким товаром красным цветом.

\subparagraph{Просто скоропорт}
Здесь выводим все товары, срок годности у которых ещё не истек. Те товары, которые увядают в ближайшие три дня подсвечиваем темножелтым. В ближайшие 7 дней - бледножелтым.

\subsection{Касса}

Данный модуль позволяет оформить заказ и оплатить его в режиме оффлайн. Для создания заказа у данного модуля есть свой интерфейс, позволяющий продавцу искать необходимые товары и добавлять их в виртуальную корзину. После того, как продавец перешел к оплате он выбирает метод "наличные", "банковской картой" или "выставить счет" и в зависимости от выбора срабатывает драйвер кассового аппарата и открывает кассу либо драйвер устройства, которое считывает данные банковской карты. \todo[inline]{По поводу выставления счета что-то кроме печати оного нужно?}

Для поиска товара продавцу нужен простой интерфейс - поиск товара по названию, а также вывод товаров простым списком, поделенным на категории/подкатегории. Также форма поиска должна принимать штрихкоды. Методы оплаты на данный момент:
\begin{itemize}
	\item Наличный расчет
	\item Оплата банковской картой
	\item Безналичный расчет (выставляем счет)
\end{itemize}

Касса ни в коем случае не должна иметь возможность пробивать больше товара, чем находится в модуле "товары/склад".

\subsubsection{Оформление покупки}
Это стандартный вид модуля "Касса" - пользователь видит свой логин, рядом кнопку "закрыть кассу" и "сменить пользователя" \todo[inline]{Нужно понять, как именно закрывают кассу и меняют пользователя}
Далее система находится в режиме ожидания - выводим номер чека, и построчно информацию о товаре, которую пользователь (кассир) вбивает. При этом курсор всегда должен автоматически прыгать в поле "название" после занесения предыдущего товара (при открытии страницы, т.е. при виде по умолчанию курсор также должен быть в поле "название"). Для ввода товара кассиру доступны следующие действия:

\begin{itemize}
	\item Сканировать штрихкод с товара специальным сканером. При сканировании товара с одним и тем же штрихкодом должен увеличиваться счетчик общего кол-ва товаров в строке. При этом после сканирования в поле "название" попадает именно штрихкод.
	\item Вбить штрихкод вручную.
	\item Ввести название товара - поле "название" обладает саджестом, который должен искать по всей базе товаров \todo[inline]{Внимание, здесь нужно особенно внимательно подойти к разработке и максимально использовать поисковую индексацию - см. как подключить Sphinx для работы с Битриксом}
\end{itemize}

Для строки товара, в которой находится на данный момент кассир можно простым нажатием на соответствующие кнопки изменить кол-во товара. Уже оформленные строки менять нельзя, можно только удалить и добавить новую строку.
\\[0.5cm]
После оформления всех товарных позиций кассир может внести клиентскую информацию (опционально). По умолчанию доступно только поле для поиска клиента и если оно не оформлено, то покупка попадает к типу клиента "ритейл". 

\paragraph{Поиск клиента}
Если оформляется заказ для постоянного клиента (или например для компании - и оплата безналом), то кассир может по следующим параметрам искать клиента:

\begin{itemize}
	\item ФИО (ищем как и в физиках, так и в юриках (в юриках должно быть контактное лицо))
	\item Название компании
	\item Телефон
\end{itemize}

Саджест должен быть по форме:
\\COMPANY-NAME - CONTACT-PERSON-NAME - PHONE(optional)

\paragraph{Оплата заказа}
После выбора метода оплаты происходят различные действия. Если выбрана оплата наличными, то кассир нажимает на соответствующую кнопка и открывается всплывающее окно, которое отображает сумму чека, позволяет вбить размер купюры, которую дал клиент и отправляет запрос на драйвер, который открывает кассовый аппарат.
\\[0.5cm]
Если выбрана оплата картой, то срабатывает интерфейс с прибором эквайринга. Данный интерфейс должен (по аналогии с онлайн оплатой через эквайринг) посылать запрос на оплату и принимать статус (оплата прошла/отклонена).
\\[0.5cm]
Для метода оплаты через безналичный расчет просто показываем форму счета, которую можно распечатать \todo[inline]{Мб с опцией отправить по почте?}

\paragraph{Завершение заказа}
Необходимо точно определить, что должно происходить с отмененным заказом. Наверное не удаляем его полностью, а сохраняем, помечаем как "удален".
\\[0.5cm]
В любом случае необходимо обновлять кол-во товаров (либо уменьшать, если оплата успешная или ничего не делать, если оплату отменили).



\paragraph{Идея для релиза Бета/Гамма}
Может быть здесь сразу сделать вывод шаблона интернет-магазина? Там есть и поиск и вывод товара по категориям/подкатегориям.

\subsubsection{Обзор покупок}
Данная страница отображает все покупки (чеки и счета) за управляемый период времени (по умолчанию это текущий день). Для просмотра доступны следующие поля:

\begin{itemize}
	\item ID клиента
	\item ФИО клиента или название компании-клиента
	\item телефон
	\item сумма покупки 
	\item дата покупки
\end{itemize}

Для каждого фильтра должны присутствовать свои собственные настройки доступа. Так, например, рядовой кассир может видеть только чеки своей смены (и не видит фильтр "за период" и "выберите дату от... до...").

\paragraph{Просмотр покупки}
Каждую покупку (чек/счет) можно просмотреть, нажав в строке покупки на "просмотреть". При этом открывается детальный обзор всех товаров данной покупки. Доступны следующие данные:

\begin{itemize}
	\item Номер чека
	\item Наименование товара
	\item Кол-во товара
	\item Цена за штуку товара
	\item Общая сумма по каждому товару
	\item Общая сумма чека
\end{itemize}

\subsection{Финансы}

Таб финансы представляет собой короткую сводку (некий финансовый dashboard), которая показывает прибыль текущего месяца, оборот, закупки, расходы на зарплату и прочие расходы текущего месяца. Рассчитывается так:

\begin{itemize}
	\item Оборот - все продажи месяца (все уходы товара и приходы денег через модуль "касса")
	\item Закупки - все оприходывания товаров месяца (модуль "товары" -> оприходывание)
	\item Расходы на зарплату - все затраты из модуля "сотрудники"
	\item Прочие расходы - расходы из модуля "финансы"
	\item Прибыль - Из оборота вычитываем все вышеописанные расходы
\end{itemize}

Помимо сводки имеются ссылки на дебиторскую и кредиторскую задолженности, на отчеты и на статьи расходов. Под ссылками на дебиторку и кредиторку расположены небольшие виджеты, которые иллюстрируют информацию из данных блоков. Показываем: общую задолженность, задолженность месяца и график сумм задолженностей по месяцам (полностью аналогично прототипу).


\subsubsection{Дебиторка/Кредиторка}

В табличной форме показываем пользователю задолженность фирмы перед поставщиками и задолженность третьих лиц перед магазином.

\paragraph{Дебиторка(должны нам)}
Рассчитывается следующим образом - товар ушел, денег нет (например продажа по счету). В данном табе каждая строка представляет собой счет, по которому ещё не прошла оплата. При нажатии на строку открывается страница просмотра счета.

\paragraph{Кредиторка(должны мы)}
Рассчитываем так - товар оприходован, но не вся сумма оплачена (разница между полями "закупочная стоимость" и "фактическая оплата"). Т.е. в данном табе нужно выводить все те накладные, по которым не было 100\% оплаты. При нажатии на строку с накладной открывается страница самой накладной.

\paragraph{Отчеты}
Для всех отчетов общими являются элементы, позволяющие управлять отрезком времени, за которые генерируется отчет. По умолчанию график показывает текущий месяц, где каждое деление графика - отдельный день. Для управления используются стандартные элементы - выпадающий список ("за текущий квартал", "за текущее полугодие", "за текущий год") и два datepicker'а для выбора кастомного периода времени.

\subparagraph{Продажи отделов}
Показываем все кассовые операции с возможностью выбрать отдел и соответствующей корректировкой графика (показывать только данные по отделу). Про отделы см. пункт \ref{subsec:newgoods}.

\subparagraph{Товарооборот}
По умолчанию видно все продажи и все закупки по всем товарам. Дополнительные поля фильтрации позволяют показать только товары определенной группы или только определенный товар.

\subparagraph{Доходы vs Расходы}
В статью доходы попадают все кассовые операции, которые являются фактическими оплатами. В расходы попадает сумма всех расходов компании (зарплата, закупки, прочие расходы)

\paragraph{Статьи расхода}
Статьи расходов представляют собой настройки по расходам, не касающихся зарплаты и закупок. В настройках по расходам можно заносить фиксированные платежи (аренда, коммунальные услуги...), вариабельные платежи (например электричество). Если пользователь установил, что платеж вариабельный, то он должен установить дату напоминания. Начиная с этой даты в данном табе, как и на главной будет срабатывать подсказка - "вы не внесли необходимую статью расходов"


%Новая глава

\subsection{Сотрудники}

Помимо стандартных CRUD действий для самих сотрудников имеем: настройки заработной платы и бонусы. Набор настроек для зарплаты:

\begin{itemize}
	\item Фиксированная часть
	\item Проценты
	\item Период выплат
\end{itemize}

Для бонусов имеем следующие настройки:

\begin{itemize}
	\item Опция - с общих продаж или с группы товаров (например только с продаж мяса)
\end{itemize}

\subsection{Клиенты}

По аналогии с сотрудниками - базовые CRUD действия для сущности "клиент". Помимо этого имеем привязку прайслиста к конкретному клиенту.

\subsubsection{Индивидуальный прайслист}
При создании прайслиста можно указать две опции - фикс. цены на каждый продукт или скидки в процентах. При этом для скидок работает ступенчатая модель - приоритетнее всего скидка на индивидуальный товар, за ней скидка на группу товаров, далее скидка на все товары.
Пример - на весь товар клиенту ООО Ромашка даются 5\% скидка. На алкогольную продукцию даются 10\%. Соответственно 10 процентов на алкоголь превалиируют над 5 процентами на все товары в разделе "алкоголь". Скидки не суммируются.

\subsection{Задачи}

На данный момент просто устанавливаем битрикс-чат.

\subsection{Производство}

Данный модуль подразумевает собственный интерфейс (аналогично играм вроде "Собери Пиццу"), который позволяет пользователю изъять из оборота (зарезервировать для себя) определенные товары и на выходе получить новый товар.

Пример - изымаем 200 кг мяса, 100 кг муки и 100 шт. яиц. На выходе получаем 1000 бургеров. 

\subsubsection{Процесс изъятия}

Для начала пользователь-производственник подает заявку товароведу на изъятие определенного перечня товара (в заявке указываем причину, конечный продукт, список ингридиентов). Эта заявка находится переходит несколько статусов - "ожидание", "принято", "отклонено (с причиной)", "необходимо уточнение".

\subsection{Поставщики}

Самый обычный список фирм-поставщиков со стандартными CRUD-действиями.

\subsection{Группы пользователей}

Для разделения прав важно - каждый модуль обладает своими правами доступа. Например работнику производства нельзя давать доступ к модулю "касса", а продавцу к модулю "производство".
Для товаров важно - разделение прав по категориям товаров. Например сотрудникам мясного цеха нельзя давать доступ к молочной продукции.
Иерархия делиться следующим образом:

\begin{itemize}
	\item Директор магазина
	\item Управляющий персонал
	\item Бухгалтерия
\end{itemize}

\end{document}